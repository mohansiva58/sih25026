<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔬 Intelligent Medical Terminology Assistant - Demo</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        .header h1 {
            font-size: 36px;
            color: #333;
            margin-bottom: 10px;
        }
        .search-container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .search-box {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }
        .search-input {
            flex: 1;
            padding: 14px 16px;
            border: 2px solid #10B981;
            border-radius: 8px;
            font-size: 16px;
            outline: none;
        }
        .search-btn {
            background: #10B981;
            color: white;
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            min-width: 120px;
        }
        .search-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .results {
            background: white;
            border: 2px solid #10B981;
            border-radius: 12px;
            padding: 24px;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 20px;
        }
        .ayush-section, .icd-section {
            padding: 16px;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 8px;
        }
        .term-name {
            font-size: 18px;
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
        }
        .term-details {
            font-size: 14px;
            color: #666;
            margin-bottom: 4px;
        }
        .confidence-meter {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
        }
        .confidence-bar {
            width: 100px;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }
        .confidence-fill {
            height: 100%;
            background: #10B981;
            transition: width 0.3s ease;
        }
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }
        .feature-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .error {
            background: #ffebee;
            border: 1px solid #f44336;
            border-radius: 8px;
            padding: 16px;
            margin-top: 20px;
            color: #d32f2f;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🔬 Intelligent Medical Terminology Assistant</h1>
        <p>AI-powered ICD-11 + AYUSH integrated search with guided diagnostic assistance</p>
    </div>

    <div class="search-container">
        <h3>🎯 Intelligent Search</h3>
        <div class="search-box">
            <input type="text" id="searchInput" class="search-input" 
                   placeholder="Enter symptom or condition (e.g., cough, fever, breathing difficulty)">
            <button id="searchBtn" class="search-btn">🔬 Search</button>
        </div>
    </div>

    <div id="results" style="display: none;"></div>

    <div class="features">
        <div class="feature-card">
            <h3>🎯 Intelligent Ranking</h3>
            <p>Advanced AI scoring algorithm ranks conditions by relevance, considering exact matches, symptoms, and clinical context.</p>
        </div>
        <div class="feature-card">
            <h3>🤔 Guided Q&A</h3>
            <p>Dynamic decision-tree questions help narrow down diagnoses when multiple high-confidence matches exist.</p>
        </div>
        <div class="feature-card">
            <h3>📋 Clinical Pathways</h3>
            <p>Integrated treatment recommendations combining traditional AYUSH protocols with modern clinical guidelines.</p>
        </div>
        <div class="feature-card">
            <h3>🔗 Dual Coding</h3>
            <p>Complete interoperability with both ICD-11 international standards and AYUSH traditional medicine codes.</p>
        </div>
    </div>

    <script>
        const API = 'http://localhost:5000';
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const resultsDiv = document.getElementById('results');

        async function intelligentSearch() {
            const term = searchInput.value.trim();
            if (!term) return;

            searchBtn.disabled = true;
            searchBtn.textContent = '🔍 Analyzing...';

            try {
                const response = await axios.get(`${API}/api/intelligent-search?term=${term}&include_icd=true`);
                displayResults(response.data);
            } catch (error) {
                console.error('Search failed:', error);
                displayError('Search failed. Please ensure the backend server is running on port 5000.');
            } finally {
                searchBtn.disabled = false;
                searchBtn.textContent = '🔬 Search';
            }
        }

        function displayResults(data) {
            if (!data.top_match) {
                displayError('No matches found for your search term.');
                return;
            }

            const confidence = Math.round(data.top_match.combined_confidence * 100);
            const confidenceColor = confidence >= 80 ? '#10B981' : confidence >= 60 ? '#F59E0B' : '#EF4444';

            resultsDiv.innerHTML = `
                <div class="results">
                    <div style="display: flex; align-items: center; margin-bottom: 16px;">
                        <span style="font-size: 20px; margin-right: 10px;">✅</span>
                        <h3 style="font-size: 20px; font-weight: 600; color: #333; margin: 0;">Top Match</h3>
                        <div class="confidence-meter" style="margin-left: auto;">
                            <div class="confidence-bar">
                                <div class="confidence-fill" style="width: ${confidence}%; background: ${confidenceColor};"></div>
                            </div>
                            <span style="font-size: 12px; font-weight: 500; color: ${confidenceColor};">${confidence}%</span>
                        </div>
                    </div>

                    <div class="result-grid">
                        <div class="ayush-section">
                            <div class="section-title">AYUSH (${data.top_match.ayush_data.system})</div>
                            <div class="term-name">${data.top_match.ayush_data.NAMC_TERM_ENG}</div>
                            <div class="term-details">${data.top_match.ayush_data.DIACRITICAL_MARKS || ''}</div>
                            <div class="term-details">Code: ${data.top_match.ayush_data.NAMC_CODE}</div>
                            ${data.top_match.ayush_data.category ? `<div style="color: #10B981; font-size: 12px; margin-top: 4px;">Category: ${data.top_match.ayush_data.category}</div>` : ''}
                        </div>

                        <div class="icd-section">
                            <div class="section-title">ICD-11 Mapping</div>
                            ${data.top_match.icd_mappings && data.top_match.icd_mappings.length > 0 ? 
                                data.top_match.icd_mappings.slice(0, 2).map(icd => `
                                    <div style="margin-bottom: 8px;">
                                        <div style="font-size: 16px; font-weight: 500; color: #333;">
                                            ${(icd.title && icd.title.replace(/<[^>]*>/g, '')) || icd.icdTitle || 'Unknown'}
                                        </div>
                                        <div style="font-size: 12px; color: #666;">
                                            Code: ${icd.theCode || icd.code || 'N/A'}
                                        </div>
                                        <div style="font-size: 10px; color: #10B981;">
                                            Confidence: ${Math.round((icd.confidence || 0.7) * 100)}%
                                        </div>
                                    </div>
                                `).join('') : 
                                '<div style="font-size: 14px; color: #999; font-style: italic;">No direct ICD-11 mapping available</div>'
                            }
                        </div>
                    </div>

                    <div style="margin-top: 16px; padding: 12px; background: #f0f9ff; border-radius: 6px; font-size: 12px; color: #1e40af;">
                        <strong>Search Statistics:</strong> Found ${data.total_results} potential matches. 
                        Relevance Score: ${data.top_match.ayush_data.relevance_score || 'N/A'}
                        ${data.guided_questions && data.guided_questions.length > 0 ? 
                            ` | Guided questions available for refinement` : ''}
                    </div>
                </div>
            `;
            resultsDiv.style.display = 'block';
        }

        function displayError(message) {
            resultsDiv.innerHTML = `<div class="error">❌ ${message}</div>`;
            resultsDiv.style.display = 'block';
        }

        searchBtn.addEventListener('click', intelligentSearch);
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') intelligentSearch();
        });

        // Demo searches
        document.addEventListener('DOMContentLoaded', () => {
            const demoTerms = ['cough', 'fever', 'headache', 'breathing difficulty'];
            let currentDemo = 0;
            
            const demoInterval = setInterval(() => {
                searchInput.placeholder = `Try searching: "${demoTerms[currentDemo]}"`;
                currentDemo = (currentDemo + 1) % demoTerms.length;
            }, 3000);
        });
    </script>
</body>
</html>